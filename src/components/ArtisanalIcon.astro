---
interface Props {
    name: string;
    size?: number;
    class?: string;
    weight?: "thin" | "light" | "regular" | "bold" | "fill" | "duotone";
    ornate?: boolean;
    "aria-label"?: string;
}

const {
    name,
    size = 24,
    class: className = "",
    weight = "regular",
    ornate = false,
    "aria-label": ariaLabel,
} = Astro.props;

// Map weights to Iconify Phosphor suffixes
const weightMap = {
    regular: "",
    thin: "-thin",
    light: "-light",
    bold: "-bold",
    fill: "-fill",
    duotone: "-duotone",
};

const iconName = `${name}${weightMap[weight] || ""}`;
const iconUrl = `https://api.iconify.design/ph:${iconName}.svg`;

let svgContent = "";
try {
    const response = await fetch(iconUrl);
    if (response.ok) {
        svgContent = await response.text();

        // Basic cleanup and adding accessibility
        svgContent = svgContent
            .replace(/width=".*?"/, `width="${size}"`)
            .replace(/height=".*?"/, `height="${size}"`)
            .replace(
                "<svg",
                `<svg aria-hidden="${!ariaLabel}" ${ariaLabel ? `aria-label="${ariaLabel}"` : ""} role="img"`,
            );
    } else {
        console.error(`Failed to fetch icon: ${iconName}`);
    }
} catch (e) {
    console.error(`Error fetching icon ${iconName}:`, e);
}
---

<div
    class={`relative inline-flex items-center justify-center shrink-0 ${className}`}
>
    {
        ornate && (
            <>
                <div class="absolute inset-[-20%] border border-gold/20 rounded-lg rotate-45 pointer-events-none transition-transform group-hover:rotate-90 duration-1000" />
                <div class="absolute inset-[-10%] border border-gold/10 rounded-sm -rotate-12 pointer-events-none transition-transform group-hover:rotate-0 duration-700" />
                <div class="absolute inset-0 bg-gold/5 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-700 rounded-full" />
            </>
        )
    }

    <Fragment
        set:html={svgContent ||
            `<span class="text-[10px] text-red-500">?${name}</span>`}
    />
</div>

<style is:global>
    /* Styling for the fetched SVGs */
    .ph-icon svg {
        display: block;
        color: currentColor;
    }

    /* Ensure duotone opacity is preserved if present */
    [fill-opacity] {
        opacity: var(--ph-duotone-opacity, 0.2);
    }
</style>
